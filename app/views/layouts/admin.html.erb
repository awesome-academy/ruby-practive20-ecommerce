<!DOCTYPE html>
<html>
  <head>
    <title><%= yield(:title) || "Admin Panel" %> | E-commerce Admin</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <%= stylesheet_link_tag "admin", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SortableJS for drag & drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  </head>

  <body class="admin-layout">
    <div class="container-fluid p-0">
      <div class="row g-0">
        <!-- Sidebar -->
        <div class="col-md-2 admin-sidebar">
          <div class="p-3">
            <h5 class="text-white"><%= t("admin.layout.admin_panel") %></h5>
          </div>
          <nav class="nav flex-column">
            <%= link_to admin_root_path, class: "nav-link #{'active' if current_page?(admin_root_path)}" do %>
              <i class="fas fa-tachometer-alt me-2"></i>
              <%= t("admin.navigation.dashboard") %>
            <% end %>
            
            <%= link_to admin_categories_path, class: "nav-link #{'active' if controller_name == 'categories'}" do %>
              <i class="fas fa-tags me-2"></i>
              <%= t("admin.navigation.category_management") %>
            <% end %>
            
            <%= link_to admin_products_path, class: "nav-link #{'active' if controller_name == 'products'}" do %>
              <i class="fas fa-box me-2"></i>
              <%= t("admin.navigation.product_management") %>
            <% end %>
            
            <div class="nav-link">
              <i class="fas fa-users me-2"></i>
              <%= t("admin.navigation.users") %>
            </div>
            
            <div class="nav-link">
              <i class="fas fa-chart-bar me-2"></i>
              <%= t("admin.navigation.reports") %>
            </div>
            
            <hr class="text-secondary">
            
            <%= link_to root_path, class: "nav-link", target: "_blank" do %>
              <i class="fas fa-external-link-alt me-2"></i>
              <%= t("admin.navigation.view_site") %>
            <% end %>
            
            <%= link_to logout_path, method: :delete, class: "nav-link", data: { turbo_method: :delete } do %>
              <i class="fas fa-sign-out-alt me-2"></i>
              <%= t("admin.navigation.logout") %>
            <% end %>
          </nav>
        </div>

        <!-- Main Content -->
        <div class="col-md-10 admin-main">
          <!-- Header -->
          <div class="admin-header">
            <div class="container-fluid px-3">
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-medium">
                  <%= t("admin.welcome_message", email: current_user&.email) %>
                </span>
                <div class="btn-group" role="group">
                  <% %w[en vi].each do |locale| %>
                    <%= link_to locale.upcase, 
                                url_for(locale: locale), 
                                class: "btn btn-sm #{'btn-primary' if I18n.locale.to_s == locale} #{'btn-outline-secondary' if I18n.locale.to_s != locale}" %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <!-- Content -->
          <div class="container-fluid py-4">
            <!-- Flash Messages -->
            <% flash.each do |type, message| %>
              <div class="alert alert-<%= type == 'notice' ? 'info' : type == 'alert' ? 'warning' : type %> alert-dismissible fade show" role="alert">
                <%= message %>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            <% end %>

            <%= yield %>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      // Initialize components when page loads
      function initializeComponents() {
        // Auto-hide alerts after 5 seconds
        const alerts = document.querySelectorAll('.alert-dismissible');
        alerts.forEach(function(alert) {
          setTimeout(function() {
            if (alert && alert.parentNode) {
              const bsAlert = new bootstrap.Alert(alert);
              bsAlert.close();
            }
          }, 5000);
        });
      }

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', initializeComponents);
      
      // Re-initialize on Turbo navigation (Rails 7)
      document.addEventListener('turbo:load', initializeComponents);
    </script>
  </body>
</html>
